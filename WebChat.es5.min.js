'use strict';

var WIDGET_VERSION = '2.0.4';
var ID_FIRSTNAME = 'cx_webchat_form_name';
var ID_ACCOUNTNUMBER = 'cx_webchat_form_accountnumber';
var ID_EMAIL = 'cx_webchat_form_email';
var ID_SUBJECT = 'cx_webchat_form_subject';
var ID_COMPANY = 'cx_webchat_form_company';
var ID_ADDRESS = 'cx_webchat_form_address';
var ID_POSTCODE = 'cx_webchat_form_postcode';
var CUSTOMFIELDLABEL_ACCOUNTNUMBER = 'Account/Serial number';
var DEFAULT_ACCOUNTNUMBER = '** No account/serial number specified **';
var CUSTOMFIELDLABEL_SUBJECT = 'Subject';
var CUSTOMFIELDLABEL_URL = 'Chat source';
var CUSTOMFIELDLABEL_PRODUCTPLAN = 'Product plan';
var CUSTOMFIELDLABEL_PRODUCTTRIAL = 'Product trial';
var CUSTOMFIELDLABEL_COMPANY = 'Company name';
var CUSTOMFIELDLABEL_ADDRESS = 'Address';
var CUSTOMFIELDLABEL_POSTCODE = 'Postcode';
var DEFAULT_SUBJECT = '** No subject specified **';
var DEFAULT_PRODUCTPLAN = '** No product plan specified **';
var DEFAULT_PRODUCTTRIAL = '** No product trial specified **';
var DEFAULT_FIRSTNAME = '** Customer **';
var DEFAULT_COMPANY = '** No company name specified **';
var DEFAULT_ADDRESS = '** No address specified **';
var DEFAULT_POSTCODE = '** No postcode specified **';
var WAITING_MESSAGE_INTERVAL = 60000; // Milliseconds.
var TRANSFERRING_MESSAGE_INTERVAL = 60000; // Milliseconds.
var TRANSFERRING_MESSAGE_DELAY = 5000; // Milliseconds.
var TRANSFERRING_MESSAGE_DELAY2 = 30000; // Milliseconds.
var LANGUAGE_SCRIPT_INTERVAL = 50; // Milliseconds.
var CXBUS_SCRIPT_INTERVAL = 50; // Milliseconds.
var REQUIRE_SCRIPT_INTERVAL = 50; // Milliseconds.
var MIN_ACCOUNTNUMBER = 6;
var MIN_NAME = 3;
var MIN_COMPANY = 3;
var MIN_ADDRESS = 5;
var ORGGUID_UKI = '4160414a-a54f-43af-a3fd-0d86c89f4a63';
var DEPLOYMENTKEY_INTERACTIONFLOW_UKI = 'c2235bc4-683a-4032-9912-b3cafa2f7a94';
var DEPLOYMENTKEY_STATUSFLOW_UKI = '22f8021d-17d7-429e-8f72-e7040fb8b42a';
var DEPLOYMENTKEY_INTERACTIONFLOW_NA = 'eba123c3-1f03-4514-a5e9-7584814d0709';
var DEPLOYMENTKEY_STATUSFLOW_NA = 'dbe442f7-0655-4cad-b811-397a1c9c0406';
var FORMTYPE_SERVICE = 'service';
var FORMTYPE_SBC = 'sbc';
var FORMTYPE_SUPPORT = 'support';
var FORMTYPE_SALES = 'sales';
var MAX_TRANSCRIPT_LINELENGTH = 60;
var KEYSMATRIXINDEX_QUEUENAME = 0;
var KEYSMATRIXINDEX_INTERACTIONFLOWDEPLOYTMENTKEY = 1;
var KEYSMATRIXINDEX_STATUSFLOWDEPLOYTMENTKEY = 2;
var LISTENER_OPEN = 'open';
var LISTENER_MESSAGE = 'message';
var MESSAGE_OPEN = 'open';
var MESSAGE_CLOSED = 'closed';
var LANGUAGE_EN = 'en';
var LANGUAGE_FR = 'fr';
var LANGUAGE_FRCA = 'fr';
var LOCALE_FR_FR = 'fr-fr';
var LOCALE_FR_CA = 'fr-ca';
var GUEST_API_URL_NO_REQUIREJS = 'https://sdk-cdn.mypurecloud.com/javascript-guest/5.3.1/purecloud-guest-chat-client.min.js'; // SDK when not using require.js.
var GUEST_API_URL = 'https://sdk-cdn.mypurecloud.com/javascript-guest/amd/6.0.1/purecloud-guest-chat-client.min.js'; // Cut down SDK.
//const GUEST_API_URL = "https://sdk-cdn.mypurecloud.com/javascript/amd/92.0.0/purecloud-platform-client-v2.min.js";  // Full SDK.

// Use these urls as per environment.
var PRODUCTION_URL_LOCAL = 'http://localhost:56093';
var PRODUCTION_URL_QA = 'https://www.sage.com/en-gb/shop/webchat';
var PRODUCTION_URL_PRODUCTION = 'https://webchathub.sage.com';
var PRODUCTION_URL = 'https://webchathub.sage.com';

var CARRIAGERETURN_NEWLINE = '\r\n';
var COOKIE_ACCOUNTNUMBER = 'AccountNumber';
var COOKIE_LASTACCOUNTNUMBER = 'LastAccountNumber';
var COOKIE_TRANSCRIPTOFFEROPEN = 'TranscriptOfferOpen';
var FLAG_TRUE = 'true';
var FLAG_FALSE = 'false';

var _keysMatrix = [
    ['100_CS_All_CHAT_ENUS_NA', DEPLOYMENTKEY_INTERACTIONFLOW_NA, DEPLOYMENTKEY_STATUSFLOW_NA],
    ['100_SLS_LeadGen_CHAT_ENUS_NA', DEPLOYMENTKEY_INTERACTIONFLOW_NA, DEPLOYMENTKEY_STATUSFLOW_NA],
    ['100CON_CS_All_CHAT_ENUS_NA', DEPLOYMENTKEY_INTERACTIONFLOW_NA, DEPLOYMENTKEY_STATUSFLOW_NA],
    ['100Con_SLS_LeadGen_CHAT_ENUS_NA', DEPLOYMENTKEY_INTERACTIONFLOW_NA, DEPLOYMENTKEY_STATUSFLOW_NA],
    ['300_CS_All_CHAT_ENUS_NA', DEPLOYMENTKEY_INTERACTIONFLOW_NA, DEPLOYMENTKEY_STATUSFLOW_NA],
    ['300_SLS_LeadGenCA_CHAT_ENUS_NA', DEPLOYMENTKEY_INTERACTIONFLOW_NA, DEPLOYMENTKEY_STATUSFLOW_NA],
    ['300_SLS_LeadGenCA_CHAT_FRCA_NA', DEPLOYMENTKEY_INTERACTIONFLOW_NA, DEPLOYMENTKEY_STATUSFLOW_NA],
    ['300_SLS_LeadGenUS_CHAT_ENUS_NA', DEPLOYMENTKEY_INTERACTIONFLOW_NA, DEPLOYMENTKEY_STATUSFLOW_NA],
    ['300CRE_CS_All_CHAT_ENUS_NA', DEPLOYMENTKEY_INTERACTIONFLOW_NA, DEPLOYMENTKEY_STATUSFLOW_NA],
    ['300CRE_SLS_LeadGen_CHAT_ENUS_NA', DEPLOYMENTKEY_INTERACTIONFLOW_NA, DEPLOYMENTKEY_STATUSFLOW_NA],
    ['50CA_CS_All_CHAT_ENUS_NA', DEPLOYMENTKEY_INTERACTIONFLOW_NA, DEPLOYMENTKEY_STATUSFLOW_NA],
    ['50CA_CS_All_CHAT_FRCA_NA', DEPLOYMENTKEY_INTERACTIONFLOW_NA, DEPLOYMENTKEY_STATUSFLOW_NA],
    ['50CA_SLS_LeadGen_CHAT_ENUS_NA', DEPLOYMENTKEY_INTERACTIONFLOW_NA, DEPLOYMENTKEY_STATUSFLOW_NA],
    ['50CA_SLS_LeadGen_CHAT_FRCA_NA', DEPLOYMENTKEY_INTERACTIONFLOW_NA, DEPLOYMENTKEY_STATUSFLOW_NA],
    ['50US_CS_All_CHAT_ENUS_NA', DEPLOYMENTKEY_INTERACTIONFLOW_NA, DEPLOYMENTKEY_STATUSFLOW_NA],
    ['50US_CS_Test_CHAT_ENUS_NA', DEPLOYMENTKEY_INTERACTIONFLOW_NA, DEPLOYMENTKEY_STATUSFLOW_NA],
    ['50US_SLS_LeadGen_CHAT_ENUS_NA', DEPLOYMENTKEY_INTERACTIONFLOW_NA, DEPLOYMENTKEY_STATUSFLOW_NA],
    ['BCAcctng_SLS_LeadGen_CHAT_ENUS_NA', DEPLOYMENTKEY_INTERACTIONFLOW_NA, DEPLOYMENTKEY_STATUSFLOW_NA],
    ['BV_CS_All_CHAT_ENUS_NA', DEPLOYMENTKEY_INTERACTIONFLOW_NA, DEPLOYMENTKEY_STATUSFLOW_NA],
    ['BW_CS_All_CHAT_ENUS_NA', DEPLOYMENTKEY_INTERACTIONFLOW_NA, DEPLOYMENTKEY_STATUSFLOW_NA],
    ['CRM_CS_All_CHAT_ENUS_NA', DEPLOYMENTKEY_INTERACTIONFLOW_NA, DEPLOYMENTKEY_STATUSFLOW_NA],
    ['CRM_SLS_LeadGen_CHAT_ENUS_NA', DEPLOYMENTKEY_INTERACTIONFLOW_NA, DEPLOYMENTKEY_STATUSFLOW_NA],
    ['CustomerCare_CS_All_CHAT_ENUS_NA', DEPLOYMENTKEY_INTERACTIONFLOW_NA, DEPLOYMENTKEY_STATUSFLOW_NA],
    ['DacEasy_CS_All_CHAT_ENUS_NA', DEPLOYMENTKEY_INTERACTIONFLOW_NA, DEPLOYMENTKEY_STATUSFLOW_NA],
    ['EST_CS_All_CHAT_ENUS_NA', DEPLOYMENTKEY_INTERACTIONFLOW_NA, DEPLOYMENTKEY_STATUSFLOW_NA],
    ['EST_SLS_LeadGen_CHAT_ENUS_NA', DEPLOYMENTKEY_INTERACTIONFLOW_NA, DEPLOYMENTKEY_STATUSFLOW_NA],
    ['FixdAsets_CS_All_CHAT_ENUS_NA', DEPLOYMENTKEY_INTERACTIONFLOW_NA, DEPLOYMENTKEY_STATUSFLOW_NA],
    ['FixdAsets_SLS_LeadGen_CHAT_ENUS_NA', DEPLOYMENTKEY_INTERACTIONFLOW_NA, DEPLOYMENTKEY_STATUSFLOW_NA],
    ['HRMS_CS_All_CHAT_ENUS_NA', DEPLOYMENTKEY_INTERACTIONFLOW_NA, DEPLOYMENTKEY_STATUSFLOW_NA],
    ['HRMS_SLS_LeadGen_CHAT_ENUS_NA', DEPLOYMENTKEY_INTERACTIONFLOW_NA, DEPLOYMENTKEY_STATUSFLOW_NA],
    ['Intacct_SLS_LeadGenCA_CHAT_ENUS_NA', DEPLOYMENTKEY_INTERACTIONFLOW_NA, DEPLOYMENTKEY_STATUSFLOW_NA],
    ['Intacct_SLS_LeadGenUS_CHAT_ENUS_NA', DEPLOYMENTKEY_INTERACTIONFLOW_NA, DEPLOYMENTKEY_STATUSFLOW_NA],
    ['IntacctConst_SLS_LeadGen_CHAT_ENUS_NA', DEPLOYMENTKEY_INTERACTIONFLOW_NA, DEPLOYMENTKEY_STATUSFLOW_NA],
    ['TimeSlips_CS_All_CHAT_ENUS_NA', DEPLOYMENTKEY_INTERACTIONFLOW_NA, DEPLOYMENTKEY_STATUSFLOW_NA],
    ['X3_SLS_LeadGen_CHAT_ENUS_NA', DEPLOYMENTKEY_INTERACTIONFLOW_NA, DEPLOYMENTKEY_STATUSFLOW_NA],
    ['USSmallBiz_SLS_LeadGen_CHAT_ENUS_NA', DEPLOYMENTKEY_INTERACTIONFLOW_NA, DEPLOYMENTKEY_STATUSFLOW_NA],
    ['USMedBiz_SLS_LeadGen_CHAT_ENUS_NA', DEPLOYMENTKEY_INTERACTIONFLOW_NA, DEPLOYMENTKEY_STATUSFLOW_NA],
    ['Construction_SLS_LeadGen_CHAT_ENUS_NA', DEPLOYMENTKEY_INTERACTIONFLOW_NA, DEPLOYMENTKEY_STATUSFLOW_NA],
    ['CASmallBiz_SLS_LeadGen_CHAT_ENUS_NA', DEPLOYMENTKEY_INTERACTIONFLOW_NA, DEPLOYMENTKEY_STATUSFLOW_NA],
    ['CAMedBiz_SLS_LeadGen_CHAT_ENUS_NA', DEPLOYMENTKEY_INTERACTIONFLOW_NA, DEPLOYMENTKEY_STATUSFLOW_NA],
    ['CASmallBiz_SLS_LeadGen_CHAT_FRCA_NA', DEPLOYMENTKEY_INTERACTIONFLOW_NA, DEPLOYMENTKEY_STATUSFLOW_NA],
    ['CAMedBiz_SLS_LeadGen_CHAT_FRCA_NA', DEPLOYMENTKEY_INTERACTIONFLOW_NA, DEPLOYMENTKEY_STATUSFLOW_NA],
    ['USGen_SLS_LeadGen_CHAT_ENUS_NA', DEPLOYMENTKEY_INTERACTIONFLOW_NA, DEPLOYMENTKEY_STATUSFLOW_NA],
    ['CAGenEN_SLS_LeadGen_CHAT_ENUS_NA', DEPLOYMENTKEY_INTERACTIONFLOW_NA, DEPLOYMENTKEY_STATUSFLOW_NA],
    ['CAGenFR_SLS_LeadGen_CHAT_FRCA_NA', DEPLOYMENTKEY_INTERACTIONFLOW_NA, DEPLOYMENTKEY_STATUSFLOW_NA],
    ['ZTR_SLS_TRN1_CHAT_enus_na', DEPLOYMENTKEY_INTERACTIONFLOW_NA, DEPLOYMENTKEY_STATUSFLOW_NA],
    ['ZTR_SLS_TRN2_CHAT_enus_na', DEPLOYMENTKEY_INTERACTIONFLOW_NA, DEPLOYMENTKEY_STATUSFLOW_NA],
    ['ZTR_SLS_TRN3_CHAT_enus_na', DEPLOYMENTKEY_INTERACTIONFLOW_NA, DEPLOYMENTKEY_STATUSFLOW_NA],
    ['ZTR_SLS_TRN4_CHAT_enus_na', DEPLOYMENTKEY_INTERACTIONFLOW_NA, DEPLOYMENTKEY_STATUSFLOW_NA],
    ['ZTR_SLS_TRN5_CHAT_enus_na', DEPLOYMENTKEY_INTERACTIONFLOW_NA, DEPLOYMENTKEY_STATUSFLOW_NA],
    ['ZTR_SLS_TRN6_CHAT_enus_na', DEPLOYMENTKEY_INTERACTIONFLOW_NA, DEPLOYMENTKEY_STATUSFLOW_NA],
    ['ZTR_SLS_TRN7_CHAT_enus_na', DEPLOYMENTKEY_INTERACTIONFLOW_NA, DEPLOYMENTKEY_STATUSFLOW_NA],
    ['ZTR_SLS_TRN8_CHAT_enus_na', DEPLOYMENTKEY_INTERACTIONFLOW_NA, DEPLOYMENTKEY_STATUSFLOW_NA],
    ['ZTR_SLS_TRN9_CHAT_enus_na', DEPLOYMENTKEY_INTERACTIONFLOW_NA, DEPLOYMENTKEY_STATUSFLOW_NA],
    ['ZTR_SLS_TRN10_CHAT_enus_na', DEPLOYMENTKEY_INTERACTIONFLOW_NA, DEPLOYMENTKEY_STATUSFLOW_NA],
    ['ZTR_SLS_TRN11_CHAT_enus_na', DEPLOYMENTKEY_INTERACTIONFLOW_NA, DEPLOYMENTKEY_STATUSFLOW_NA],
    ['ZTR_SLS_TRN12_CHAT_enus_na', DEPLOYMENTKEY_INTERACTIONFLOW_NA, DEPLOYMENTKEY_STATUSFLOW_NA],
];

var _chatButtonsClassList = ['chat-button', 'ccaas-container', 'cx-container'];
var _closedMessagesClassList = ['cx-closed'];
var _checkingMessagesClassList = ['cx-checking', 'cx-verifying'];

var _selectedSubject = '';
var _chatTranscript = '';
var _customPlugin;
var _accountNumberRequired = false;
var _emailRequired = false;
var _debug = false;
var _waitingMessageIntervalTimer;
var _initialWaitingMessageCount = 3;
var _transferringMessageIntervalTimer;
var _agentConnected = false;
var _chatConnected = false;
var _pdfEnabled = false;
var _formJson = false;
var _socket;
var _self;
var _overrideStatus = '';
var _platformClient;
var _client;
var _requireJs = true;
var _language;
var _languageScriptInterval;
var _cxbusScriptInterval;
var _requireScriptInterval;
var _requireScriptInterval2;
var _lastTranscriptMsg = '';
var _addWebFormDataToTranscript = true;
var _autoSubmit = false;
var _queue;

function getFormattedDate() {
    var longFormat = arguments.length <= 0 || arguments[0] === undefined ? false : arguments[0];

    var now = new Date();

    var d = now.getDate();
    var m = MONTHS[now.getMonth()];
    var mm = LONG_MONTHS[now.getMonth()];
    var y = now.getFullYear();

    var result = longFormat ? d + ' ' + mm + ' ' + y : d + m + y;

    return result;
}

function getFormattedDateTime() {
    var now = new Date();

    var day = DAYS[now.getDay()];
    var d = now.getDate();
    var m = MONTHS[now.getMonth()];
    var y = now.getFullYear();

    var result = day + ' ' + m + ' ' + d + ' ' + y + ' ' + now.toLocaleTimeString();

    return result;
}

function addToChatTranscript(msg) {
    var includeDate = arguments.length <= 1 || arguments[1] === undefined ? true : arguments[1];

    // Stop repeating messages.
    if (msg === _lastTranscriptMsg) {
        return;
    } else {
        _lastTranscriptMsg = msg;
    }

    try {
        if (!_pdfEnabled && _chatTranscript.length === 0) {
            // Start message for text transcript.
            _chatTranscript = TRANSCRIPT_STARTMESSAGE;
        }

        if (includeDate) {
            if (_chatTranscript.length > 0) {
                _chatTranscript += CARRIAGERETURN_NEWLINE + CARRIAGERETURN_NEWLINE;
            }

            _chatTranscript += getFormattedDateTime();
            _chatTranscript += CARRIAGERETURN_NEWLINE;
        } else {
            if (_chatTranscript.length > 0) {
                _chatTranscript += CARRIAGERETURN_NEWLINE;
            }
        }

        var msgLength = msg.length;

        if (_pdfEnabled || msgLength <= MAX_TRANSCRIPT_LINELENGTH) {
            _chatTranscript += msg;
        } else {
            var words = msg.split(' ');

            var i, j;
            var lineLength = 0;

            for (i = 0, j = words.length; i < j; i++) {
                var word = words[i];
                lineLength += word.length;

                if (lineLength > MAX_TRANSCRIPT_LINELENGTH) {
                    lineLength = 0;
                    _chatTranscript += CARRIAGERETURN_NEWLINE;
                }

                _chatTranscript += word;
                _chatTranscript += ' ';
            }
        }
    } catch (e) {
        logConsoleMessage(e);
    }
}

function formatTranscriptAsPdf(t) {
    var x, y;
    var logoHeight = 10;
    var logoWidth = 26;
    var doc = new jsPDF();

    doc.addFont('Arial', 'arial', 'normal');
    doc.addFont('Arial-Bold', 'arial', 'bold');

    // jsPDF library can't use SVG, adding as URI instead
    var logoUri =
        'data:image/png;base64,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';

    // add Sage logo to top-right corner
    doc.addImage(logoUri, 'png', 195 - logoWidth, 15, logoWidth, logoHeight);

    // initialise cursor location and font
    doc.setFont('arial');
    x = 15;
    var xIndented = 15;
    y = 20;

    // transcript title and date
    doc.setFontSize(22);
    doc.setFontType('bold');
    doc.text(x, y, TRANSCRIPT_TITLE);
    y += 6;
    doc.setFontSize(11);
    doc.setFontType('normal');
    doc.text(x, y, getFormattedDate(true));

    y += 18;
    doc.setFontType('bold');
    doc.text(x, y, TRANSCRIPT_DETAIL);
    doc.setFontType('normal');
    y += 18;

    var rows = t.split('\n');

    for (var i = 0; i < rows.length; i++) {
        var text = rows[i];

        var splitText = doc.splitTextToSize(text, 130);

        for (var j = 0; j < splitText.length; j++) {
            if (splitText[j] !== '') {
                doc.text(xIndented, y, splitText[j]);
                y = y + 6;

                if (y >= 280) {
                    doc.addPage();
                    y = 20;
                }
            }
        }
    }

    var filename = 'SageChatTranscript-' + getFormattedDate() + '.pdf';
    doc.save(filename);

    return doc;
}

function logConsoleMessage(msg, e) {
    if (_debug) {
        var temp = '##SageWebChat: ' + msg;

        if (e) {
            console.log(temp, e);
        } else {
            console.log(temp);
        }
    }
}

function isEmailValid(email) {
    var result = true;

    try {
        var temp = email.toLowerCase().trim();

        result =
            /^((([a-z]|\d|[!#\$%&\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+(\.([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+)*)|((\x22)((((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(([\x01-\x08\x0b\x0c\x0e-\x1f\x7f]|\x21|[\x23-\x5b]|[\x5d-\x7e]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(\\([\x01-\x09\x0b\x0c\x0d-\x7f]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]))))*(((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(\x22)))@((([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.)+(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.?$/i.test(
                temp
            );
    } catch (e) {}

    return result;
}

function isAccountNumberValid(accountNumber) {
    var result = true;

    try {
        var temp = accountNumber.toLowerCase().trim();

        result = temp.length >= MIN_ACCOUNTNUMBER;
    } catch (e) {}

    return result;
}

function isNameValid(name) {
    var result = true;

    try {
        var temp = name.toLowerCase().trim();

        result = temp.length >= MIN_NAME;
    } catch (e) {}

    return result;
}

function isCompanyValid(company) {
    var result = true;

    try {
        var temp = company.toLowerCase().trim();

        result = temp.length >= MIN_COMPANY;
    } catch (e) {}

    return result;
}

function isAddressValid(address) {
    var result = true;

    try {
        var temp = address.toLowerCase().trim();

        result = temp.length >= MIN_ADDRESS;
    } catch (e) {}

    return result;
}

function getQueueFromWidget() {
    var result = '';

    try {
        var element = document.getElementById(ID_SUBJECT);

        if (element) {
            if (element.tagName.toLowerCase() === 'select') {
                result = element.options[element.selectedIndex].value;
            }
        }
    } catch (e) {}

    return result;
}

function getFormValue(elementId) {
    var result = '';

    var element = document.getElementById(elementId);

    if (element) {
        // If a 'select' control get the selected text.
        if (element.tagName.toLowerCase() === 'select') {
            result = element.options[element.selectedIndex].text;
        } else {
            result = element.value.trim();
        }
    }

    return result;
}

function getFormFirstName() {
    var result = getFormValue(ID_FIRSTNAME);

    return result;
}

function getFormAccountNumber() {
    var result = getFormValue(ID_ACCOUNTNUMBER);

    return result;
}

function getFormSubject() {
    var result = getFormValue(ID_SUBJECT);

    return result;
}

function getFormEmail() {
    var result = getFormValue(ID_EMAIL);

    return result;
}

function getFormCompany() {
    var result = getFormValue(ID_COMPANY);

    return result;
}

function getFormAddress() {
    var result = getFormValue(ID_ADDRESS);

    return result;
}

function getFormPostcode() {
    var result = getFormValue(ID_POSTCODE);

    return result;
}

function getSalesforceSearchValue() {
    var result = '';

    try {
        if (result.length == 0) {
            var element = document.getElementById(ID_EMAIL);

            if (element) {
                result = element.value.trim();
            }
        }

        if (result.length == 0) {
            var element = document.getElementById(ID_ACCOUNTNUMBER);

            if (element) {
                result = element.value.trim();
            }
        }
    } catch (e) {}

    return result;
}

function getCurrentUrl() {
    var result = '';

    try {
        result = window.location.href;

        var info = getBrowser();
        logConsoleMessage(info);

        if (info !== undefined) {
            result += ' (Browser: ' + info.browser + ', OS: ' + info.os + ')';
        }
    } catch (e) {}

    return result;
}

function injectTransferringMessage() {
    logConsoleMessage('Checking to see if we are waiting for an agent to join after a transfer');

    if (_chatConnected && _agentConnected == false) {
        injectMessage(MESSAGE_TRANSFERRING);
    } else {
        // Full disconnect expected.
        clearTransferringMessageIntervalTimer();
    }
}

function clearWaitingMessageIntervalTimer() {
    try {
        if (_waitingMessageIntervalTimer) {
            clearInterval(_waitingMessageIntervalTimer);
        }
    } catch (e) {}
}

function clearTransferringMessageIntervalTimer() {
    try {
        if (_transferringMessageIntervalTimer) {
            clearInterval(_transferringMessageIntervalTimer);
        }
    } catch (e) {}
}

function getProductionDomain() {
    var result = PRODUCTION_URL;

    return result;
}

var SageWebChatApi = function SageWebChatApi(options) {
    var _this = this;

    _self = this;

    /* Override options to use Sage-Sit
     */
    options.queue = '100CON_CS_All_CHAT_ENUS_NA';
    options.deploymentKey = '24ef58a0-a98f-47cf-b5d0-2d56d0ddda76';
    options.orgGuid = '0dc1cc97-d064-4533-a4e6-2dfb0b554eef';
    options.statusFlowDeploymentKey = '4e2f2766-c13f-4dbc-a6b7-b64c10c02384';

    this.options = options;

    _overrideStatus = this.options.overrideStatus ? this.options.overrideStatus : '';
    _queue = this.options.queue ? this.options.queue : '';

    this.isChatOpen = false;
    window.connectedToPlatform = false;

    if (this.options.debug) {
        _debug = this.options.debug;
    }

    if (this.options.pdfEnabled !== undefined) {
        _pdfEnabled = this.options.pdfEnabled;
    }

    if (this.options.requireJs !== undefined) {
        // RequireJs determines how we load the platformClient script.
        _requireJs = this.options.requireJs;
    }

    if (this.options.autoSubmit !== undefined) {
        _autoSubmit = this.options.autoSubmit;
    }

    var verifyQueueStatus = true;

    if (this.options.verifyQueueStatus !== undefined) {
        verifyQueueStatus = this.options.verifyQueueStatus;
    }

    var myAccountNumber = this.options.accountNumber ? this.options.accountNumber : '';
    setCookie(COOKIE_ACCOUNTNUMBER, myAccountNumber);

    setCookie(COOKIE_TRANSCRIPTOFFEROPEN, FLAG_FALSE);

    _addWebFormDataToTranscript = this.options.addDataToTranscript !== undefined ? options.addDataToTranscript : true;

    var isIe11 = isIE11OrBelow();

    _accountNumberRequired = this.isAccountNumberRequired();
    _emailRequired = this.isEmailRequired();
    _language = this.getValidLanguage();

    var domain = getProductionDomain();
    var scriptUrl = domain + '/Scripts/lang/' + _language + '.js';
    insertScript(scriptUrl);

    _languageScriptInterval = setInterval(function () {
        // Set interval while language script loads.
        if (typeof REQUIRED !== 'undefined') {
            _this.formJSON = _this.getFormJSON();
            _formJson = _this.formJSON;

            if (_languageScriptInterval) {
                clearInterval(_languageScriptInterval);
            }

            return;
        }
    }, LANGUAGE_SCRIPT_INTERVAL);

    insertScript('https://apps.mypurecloud.ie/widgets/9.0/cxbus.min.js');
    scriptUrl = domain + '/Scripts/detect-browser.min.js';
    insertScript(scriptUrl);

    if (!_requireJs) {
        if (!isIe11) {
            // This is the script to use for queue status if require.js is not being used.
            // Only load it if not IE11.  Throws a syntax error in IE11.
            insertScript(GUEST_API_URL_NO_REQUIREJS);
        }
    }

    if (_pdfEnabled) {
        insertScript('https://cdnjs.cloudflare.com/ajax/libs/jspdf/1.3.4/jspdf.min.js');
    }

    _cxbusScriptInterval = setInterval(function () {
        // Set interval while cxbus script loads, i.e. cxbus.min.js.
        if (window.hasOwnProperty('CXBus') && typeof REQUIRED !== 'undefined') {
            _this.init();

            if (_cxbusScriptInterval) {
                clearInterval(_cxbusScriptInterval);
            }
            return;
        }
    }, CXBUS_SCRIPT_INTERVAL);

    if (isIe11 || !verifyQueueStatus) {
        // Do not look up the chat queue open/close state from Genesys.
        // Always show the chat button.
        this.isChatOpen = true;

        window.addEventListener('load', function () {
            showChatButtons();
        });
    } else {
        if (_requireJs) {
            // This method is used for www.sage.com web sites because of a require conflict.

            _requireScriptInterval = setInterval(function () {
                // Set interval while requirejs script loads, i.e. require.js.
                if (window.hasOwnProperty('requirejs')) {
                    requirejs([GUEST_API_URL], function (platformClient) {
                        _platformClient = platformClient;
                        _client = platformClient.ApiClient.instance;

                        // Set environment to mypurecloud.ie.
                        _client.setEnvironment(platformClient.PureCloudRegionHosts.eu_west_1);

                        _this.verifyWebChatStatusFromFlow();
                    });

                    if (_requireScriptInterval) {
                        clearInterval(_requireScriptInterval);
                    }

                    return;
                }
            }, REQUIRE_SCRIPT_INTERVAL);
        } else {
            _requireScriptInterval = setInterval(function () {
                // Set interval while require script loads, i.e. purecloud-guest-chat-client.min.js.
                if (window.hasOwnProperty('require')) {
                    _platformClient = require('platformClient');
                    _client = _platformClient.ApiClient.instance;

                    // Set environment to mypurecloud.ie.
                    _client.setEnvironment(_platformClient.PureCloudRegionHosts.eu_west_1);

                    _this.verifyWebChatStatusFromFlow();

                    if (_requireScriptInterval) {
                        clearInterval(_requireScriptInterval);
                    }

                    return;
                }
            }, REQUIRE_SCRIPT_INTERVAL);
        }
    }
};

function showHideElements(show, classes) {
    var i;
    var hideClassName = 'cx-hidden';

    for (i = 0; i < classes.length; i++) {
        var myClass = classes[i];

        var elements = document.getElementsByClassName(myClass);
        var j;

        for (j = 0; j < elements.length; j++) {
            var element = elements[j];

            if (show) {
                if (element.classList.contains(hideClassName)) {
                    element.classList.remove(hideClassName);
                }
            } else {
                if (!element.classList.contains(hideClassName)) {
                    element.classList.add(hideClassName);
                }
            }
        }
    }
}

function hideChatButtons() {
    var show = false;
    showHideElements(show, _chatButtonsClassList);
}

function showChatButtons() {
    var show = true;
    showHideElements(show, _chatButtonsClassList);
}

function hideClosedMessages() {
    var show = false;
    showHideElements(show, _closedMessagesClassList);
}

function showClosedMessages() {
    var show = true;
    showHideElements(show, _closedMessagesClassList);
}

function hideCheckingMessages() {
    var show = false;
    showHideElements(show, _checkingMessagesClassList);
}

function showCheckingMessages() {
    var show = true;
    showHideElements(show, _checkingMessagesClassList);
}

// Polyfill for CustomEvent so that it works in Internet Explorer.
(function () {
    if (typeof window.CustomEvent === 'function') return false;

    function CustomEvent(event, params) {
        params = params || { bubbles: false, cancelable: false, detail: undefined };
        var evt = document.createEvent('CustomEvent');
        evt.initCustomEvent(event, params.bubbles, params.cancelable, params.detail);
        return evt;
    }

    CustomEvent.prototype = window.Event.prototype;

    window.CustomEvent = CustomEvent;
})();

function processWebChatSocketMessage(e) {
    var message = JSON.parse(e.data);

    if (message && message.eventBody !== undefined && message.eventBody.body !== undefined) {
        var messageBody = message.eventBody.body.toLowerCase();

        if (messageBody === MESSAGE_CLOSED || messageBody == MESSAGE_OPEN) {
            window.dispatchEvent(
                new CustomEvent('WebChatQueueInfo', {
                    detail: { name: _queue, status: messageBody },
                })
            );

            var msg = 'processWebChatSocketMessage ' + messageBody;
            logConsoleMessage(msg, e);

            hideCheckingMessages();

            // Stop listening for messages.
            _socket.removeEventListener(LISTENER_MESSAGE, processWebChatSocketMessage);

            var open = messageBody === MESSAGE_OPEN;

            if (_overrideStatus.length > 0) {
                open = _overrideStatus === MESSAGE_OPEN;
            }

            if (open) {
                _self.isChatOpen = true;

                showChatButtons();
            } else {
                showClosedMessages();
            }

            // Close socket.
            _socket.removeEventListener(LISTENER_OPEN, openWebChatSocket);
        }
    }
}

function openWebChatSocket(e) {
    logConsoleMessage('WebSocket connected', e);
}

SageWebChatApi.prototype.verifyWebChatStatusFromFlow = function () {
    hideChatButtons();
    hideClosedMessages();
    showCheckingMessages();

    var myOrgGuid = this.options.orgGuid ? this.options.orgGuid : ORGGUID_UKI;
    var myStatusFlowDeploymentKey = this.getStatusFlowDeploymentKey();

    var webChatApi = new _platformClient.WebChatApi();

    var createChatBody = {
        organizationId: myOrgGuid,
        deploymentId: myStatusFlowDeploymentKey,
        routingTarget: {
            targetType: 'QUEUE',
            targetAddress: this.options.queue,
        },
        memberInfo: {
            displayName: 'Status check',
            profileImageUrl: 'https://www.webchathub.sage.com/images/sageLogo.png',
            customFields: {
                firstName: 'Web',
                lastName: 'Chat',
            },
        },
    };

    // Create chat
    webChatApi
        .postWebchatGuestConversations(createChatBody)
        .then(function (createChatResponse) {
            // Store chat info.
            var chatInfo = createChatResponse;

            if (!_requireJs) {
                // Set JWT.
                _client.setJwt(chatInfo.jwt);
            }

            // Connect to notifications.
            _socket = new WebSocket(chatInfo.eventStreamUri);

            // Open socket.
            _socket.addEventListener(LISTENER_OPEN, openWebChatSocket);

            // Listen for messages.
            _socket.addEventListener(LISTENER_MESSAGE, processWebChatSocketMessage);
        })
        ['catch'](console.error);
};

function insertScript(scriptUrl) {
    if (typeof scriptUrl !== 'string') return;

    var head = document.getElementsByTagName('head')[0];

    var newScript = document.createElement('script');
    newScript.type = 'text/javascript';
    newScript.src = scriptUrl;

    head.appendChild(newScript);
}

SageWebChatApi.prototype.isRequired = function (search) {
    var result = false;

    try {
        if (this.options === null || this.options.requiredFields === undefined) {
            throw 'Option not defined';
        }

        var fields = this.options.requiredFields.split(',');
        var i;

        for (i = 0; i < fields.length; i++) {
            var field = fields[i].toLowerCase();

            if (field === search) {
                result = true;
                break;
            }
        }
    } catch (e) {}

    return result;
};

SageWebChatApi.prototype.isEmailRequired = function () {
    var result = this.isRequired('email');

    return result;
};

SageWebChatApi.prototype.isAccountNumberRequired = function () {
    var result = this.isRequired('accountnumber');

    return result;
};

SageWebChatApi.prototype.getWidgetItem = function (itemId) {
    var result = {};

    var inputName;
    var placeHolder;
    switch (itemId) {
        case 'firstname':
            result = {
                id: ID_FIRSTNAME,
                name: itemId,
                maxlength: '64',
                placeholder: LABEL_FIRSTNAME,
                label: REQUIRED,
                wrapper: '<tr><td>{input}</td></tr><tr><td>{label}</td></tr>',
                validateWhileTyping: false,
                validate: function validate(event, form, input, label, $, CXBus, Common) {
                    var result = true;
                    var elementValue = '';

                    if (input && input.length > 0) {
                        var element = input[0];
                        elementValue = element.value.trim();

                        result = isNameValid(elementValue);

                        if (result) {
                            input.parent().parent().next().children().children().removeClass('cx-error');
                        } else {
                            input.parent().parent().next().children().children().addClass('cx-error');
                        }
                    }

                    return result;
                },
            };
            break;

        case 'accountnumber':
            inputName = itemId;
            placeHolder = _accountNumberRequired ? REQUIRED : OPTIONAL;

            result = {
                id: ID_ACCOUNTNUMBER,
                name: inputName,
                maxlength: '32',
                placeholder: LABEL_ACCOUNTNUMBER,
                label: placeHolder,
                wrapper: '<tr><td>{input}</td></tr><tr><td>{label}</td></tr>',
                validateWhileTyping: false,
                validate: function validate(event, form, input, label, $, CXBus, Common) {
                    var result = true;
                    var elementValue = '';

                    if (input && input.length > 0) {
                        var element = input[0];
                        elementValue = element.value.trim();
                    }

                    if (input && _accountNumberRequired) {
                        result = isAccountNumberValid(elementValue);
                    }

                    if (CXBus) {
                        if (elementValue.length === 0) {
                            elementValue = DEFAULT_ACCOUNTNUMBER;
                        }

                        var salesforceSearchValue = getSalesforceSearchValue();
                        CXBus.command('WebChatService.configure', {
                            userData: { customField1Label: CUSTOMFIELDLABEL_ACCOUNTNUMBER, customField1: elementValue, SF_SearchValue: salesforceSearchValue },
                        });
                    }

                    return result;
                },
            };
            break;

        case 'email':
            inputName = itemId;
            placeHolder = _emailRequired ? REQUIRED : OPTIONAL;

            result = {
                id: ID_EMAIL,
                name: inputName,
                maxlength: '256',
                placeholder: LABEL_EMAIL,
                label: placeHolder,
                wrapper: '<tr><td>{input}</td></tr><tr><td>{label}</td></tr>',
                validateWhileTyping: false,
                validate: function validate(event, form, input, label, $, CXBus, Common) {
                    var result = true;
                    var elementValue = '';

                    if (input && _emailRequired && input.length > 0) {
                        var element = input[0];
                        elementValue = element.value.trim();

                        result = isEmailValid(elementValue);

                        if (result) {
                            input.parent().parent().next().children().children().removeClass('cx-error');
                        } else {
                            input.parent().parent().next().children().children().addClass('cx-error');
                        }
                    }

                    if (CXBus) {
                        var salesforceSearchValue = getSalesforceSearchValue();
                        CXBus.command('WebChatService.configure', { userData: { SF_SearchValue: salesforceSearchValue } });
                    }

                    return result;
                },
            };
            break;

        case 'company':
            inputName = itemId;
            placeHolder = REQUIRED;

            result = {
                id: ID_COMPANY,
                name: inputName,
                maxlength: '256',
                placeholder: LABEL_COMPANY,
                label: placeHolder,
                wrapper: '<tr><td>{input}</td></tr><tr><td>{label}</td></tr>',
                validateWhileTyping: false,
                validate: function validate(event, form, input, label, $, CXBus, Common) {
                    var result = true;
                    var elementValue = '';

                    if (input && input.length > 0) {
                        var element = input[0];
                        elementValue = element.value.trim();

                        result = isCompanyValid(elementValue);

                        if (result) {
                            input.parent().parent().next().children().children().removeClass('cx-error');
                        } else {
                            input.parent().parent().next().children().children().addClass('cx-error');
                        }
                    }

                    if (CXBus) {
                        if (elementValue.length === 0) {
                            elementValue = DEFAULT_COMPANY;
                        }

                        CXBus.command('WebChatService.configure', { userData: { customField6Label: CUSTOMFIELDLABEL_COMPANY, customField6: elementValue } });
                    }

                    return result;
                },
            };
            break;

        case 'address':
            inputName = itemId;
            placeHolder = REQUIRED;

            result = {
                id: ID_ADDRESS,
                name: inputName,
                maxlength: '256',
                placeholder: LABEL_ADDRESS,
                label: placeHolder,
                wrapper: '<tr><td>{input}</td></tr><tr><td>{label}</td></tr>',
                validateWhileTyping: false,
                validate: function validate(event, form, input, label, $, CXBus, Common) {
                    var result = true;
                    var elementValue = '';

                    if (input && input.length > 0) {
                        var element = input[0];
                        elementValue = element.value.trim();

                        result = isAddressValid(elementValue);

                        if (result) {
                            input.parent().parent().next().children().children().removeClass('cx-error');
                        } else {
                            input.parent().parent().next().children().children().addClass('cx-error');
                        }
                    }

                    if (CXBus) {
                        if (elementValue.length === 0) {
                            elementValue = DEFAULT_ADDRESS;
                        }

                        CXBus.command('WebChatService.configure', { userData: { customField7Label: CUSTOMFIELDLABEL_ADDRESS, customField7: elementValue } });
                    }

                    return result;
                },
            };
            break;

        case 'postcode':
            inputName = itemId;
            placeHolder = OPTIONAL;

            result = {
                id: ID_POSTCODE,
                name: inputName,
                maxlength: '10',
                placeholder: LABEL_POSTCODE,
                label: placeHolder,
                wrapper: '<tr><td>{input}</td></tr><tr><td>{label}</td></tr>',
                validateWhileTyping: false,
                validate: function validate(event, form, input, label, $, CXBus, Common) {
                    var result = true;
                    var elementValue = '';

                    if (input && input.length > 0) {
                        var element = input[0];
                        elementValue = element.value.trim();
                    }

                    if (CXBus) {
                        if (elementValue.length === 0) {
                            elementValue = DEFAULT_POSTCODE;
                        }

                        CXBus.command('WebChatService.configure', { userData: { customField8Label: CUSTOMFIELDLABEL_POSTCODE, customField8: elementValue } });
                    }

                    return result;
                },
            };
            break;

        case 'subject':
            if (this.options.reasonQueues == null) {
                result = {
                    id: ID_SUBJECT,
                    name: 'subject',
                    maxlength: '256',
                    placeholder: LABEL_SUBJECT,
                    label: SUBJECT,
                    wrapper: '<tr><td>{input}</td></tr><tr><td>{label}</td></tr>',
                    validateWhileTyping: false,
                    validate: function validate(event, form, input, label, $, CXBus, Common) {
                        var result = true;
                        var elementValue = '';

                        if (input && input.length > 0) {
                            var element = input[0];
                            elementValue = element.value.trim();
                        }

                        if (CXBus) {
                            if (elementValue.length === 0) {
                                elementValue = DEFAULT_SUBJECT;
                            }

                            CXBus.command('WebChatService.configure', { userData: { customField2Label: CUSTOMFIELDLABEL_SUBJECT, customField2: elementValue } });
                        }

                        return result;
                    },
                };
            } else {
                var itemOptions = [];
                var count = 0;

                this.options.reasonQueues.forEach(function (element) {
                    var i = {
                        text: element[0],
                        value: element[1],
                    };

                    itemOptions.push(i);

                    if (count === 0) {
                        _selectedSubject = element[1];
                    }

                    count++;
                });

                result = {
                    id: ID_SUBJECT,
                    name: itemId,
                    maxlength: '256',
                    label: LABEL_SUBJECT,
                    wrapper: '<tr><td>Product<br />{input}</td></tr><tr><td>{label}</td></tr>',
                    type: 'select',
                    options: itemOptions,
                };
            }
            break;

        case 'sfsearchvalue':
            result = {
                id: 'cx_webchat_form_sf_searchvalue',
                name: 'SF_SearchValue',
                maxlength: '256',
                placeholder: 'Custom data placeholder',
                label: 'SF_SearchValue',
            };
            break;
    }

    return result;
};

SageWebChatApi.prototype.getFormJSON = function () {
    var result = [];
    var firstNameItem = this.getWidgetItem('firstname');
    var emailItem = this.getWidgetItem('email');
    var accountNumberItem = this.getWidgetItem('accountnumber');
    var subjectItem = this.getWidgetItem('subject');
    var companyItem = this.getWidgetItem('company');
    var addressItem = this.getWidgetItem('address');
    var postcodeItem = this.getWidgetItem('postcode');
    var formType = this.options.formType ? this.options.formType.toLowerCase() : FORMTYPE_SERVICE;

    if (formType === FORMTYPE_SERVICE) {
        result.push(firstNameItem);
        result.push(subjectItem);
        result.push(accountNumberItem);
        result.push(emailItem);
    } else if (formType === FORMTYPE_SBC) {
        result.push(firstNameItem);
        result.push(subjectItem);
        result.push(emailItem);
    } else if (formType === FORMTYPE_SUPPORT) {
        result.push(firstNameItem);
        result.push(subjectItem);
        result.push(accountNumberItem);
        result.push(emailItem);
        result.push(companyItem);
        result.push(addressItem);
        result.push(postcodeItem);
    } else {
        result.push(firstNameItem);
        result.push(accountNumberItem);
        result.push(subjectItem);
        result.push(emailItem);
    }

    return result;
};

function getAdvancedConfig(formJSON) {
    // Hack to fix issue where formJSON is undefined.
    var tempJson = formJSON ? formJSON : _formJson;

    var result = {
        form: {
            autoSubmit: false,
        },
        formJSON: {
            wrapper: '<table>' + FORM_INTRO_TEXT + '</table>',
            inputs: tempJson,
        },
    };

    return result;
}

SageWebChatApi.prototype.startWebChat = function () {
    var validSession = isValidSession();

    if (!validSession) {
        // This is web chat between sessions with different accounts.
        // Do not start a new chat.
        launchWebChatIsUnavailbleToaster();
        return;
    }

    var config = getAdvancedConfig(this.formJSON);

    _customPlugin.command('WebChat.open', config);
};

function getAutoAdvancedConfig(formJSON, myFirstName, mySubject, myAccountNumber, myEmail, myCompany, myAddress, myPostcode) {
    var result = {
        form: {
            autoSubmit: true,
            firstname: myFirstName,
            lastname: '',
            email: myEmail,
            subject: mySubject,
            accountnumber: myAccountNumber,
            company: myCompany,
            address: myAddress,
            postcode: myPostcode,
        },
        formJSON: {
            wrapper: '<table>' + FORM_INTRO_TEXT + '</table>',
            inputs: formJSON,
        },
    };

    return result;
}

SageWebChatApi.prototype.startAutoWebChat = function (options) {
    var validSession = isValidSession();

    if (!validSession) {
        // This is web chat between sessions with different accounts.
        // Do not start a new chat.
        launchWebChatIsUnavailbleToaster();
        return;
    }

    var formJSON = this.formJSON ? this.formJSON : _formJson;
    var myFirstName = options && options.name ? options.name : '';
    var myAccountNumber = options && options.accountNumber ? options.accountNumber : '';
    var mySubject = options && options.issue ? options.issue : '';
    var myEmail = options && options.email ? options.email : '';
    var myProductPlan = options && options.product && options.product.plan ? options.product.plan : '';
    var myProductTrial = options && options.product && options.product.trial ? options.product.trial : '';
    var myCompany = options && options.company ? options.company : '';
    var myAddress = options && options.address ? options.address : '';
    var myPostcode = options && options.postcode ? options.postcode : '';

    setCookie(COOKIE_TRANSCRIPTOFFEROPEN, FLAG_FALSE);
    setCookie(COOKIE_LASTACCOUNTNUMBER, myAccountNumber);

    // Set default values otherwise the form will not auto submit.

    if (myFirstName.length == 0) {
        myFirstName = DEFAULT_FIRSTNAME;
    }

    if (myAccountNumber.length == 0) {
        myAccountNumber = DEFAULT_ACCOUNTNUMBER;
    }

    if (mySubject.length == 0) {
        mySubject = DEFAULT_SUBJECT;
    }

    if (myCompany.length == 0) {
        myCompany = DEFAULT_COMPANY;
    }

    if (myAddress.length == 0) {
        myAddress = DEFAULT_ADDRESS;
    }

    var obj = formJSON.filter(function (obj) {
        return obj.id == ID_FIRSTNAME;
    });
    if (obj.length > 0) {
        obj[0].value = myFirstName;
    }

    obj = formJSON.filter(function (obj) {
        return obj.id == ID_ACCOUNTNUMBER;
    });
    if (obj.length > 0) {
        obj[0].value = myAccountNumber;
    }

    obj = formJSON.filter(function (obj) {
        return obj.id == ID_SUBJECT;
    });
    if (obj.length > 0) {
        obj[0].value = mySubject;
    }

    obj = formJSON.filter(function (obj) {
        return obj.id == ID_EMAIL;
    });
    if (obj.length > 0) {
        obj[0].value = myEmail;
    }

    obj = formJSON.filter(function (obj) {
        return obj.id == ID_COMPANY;
    });
    if (obj.length > 0) {
        obj[0].value = myCompany;
    }

    obj = formJSON.filter(function (obj) {
        return obj.id == ID_ADDRESS;
    });
    if (obj.length > 0) {
        obj[0].value = myAddress;
    }

    obj = formJSON.filter(function (obj) {
        return obj.id == ID_POSTCODE;
    });
    if (obj.length > 0) {
        obj[0].value = myPostcode;
    }

    var myUrl = getCurrentUrl();

    var config = getAutoAdvancedConfig(formJSON, myFirstName, mySubject, myAccountNumber, myEmail, myCompany, myAddress, myPostcode);

    var mySearchValue = '';

    if (mySearchValue.length == 0) {
        if (myEmail.length > 0) {
            mySearchValue = myEmail;
        }
    }

    if (mySearchValue.length == 0) {
        if (myAccountNumber.length > 0) {
            mySearchValue = myAccountNumber;
        }
    }

    var myUserData = {
        customField1Label: CUSTOMFIELDLABEL_ACCOUNTNUMBER,
        customField1: myAccountNumber,
        customField2Label: CUSTOMFIELDLABEL_SUBJECT,
        customField2: mySubject,
        customField3Label: CUSTOMFIELDLABEL_URL,
        customField3: myUrl,
        customField4Label: CUSTOMFIELDLABEL_PRODUCTPLAN,
        customField4: myProductPlan,
        customField5Label: CUSTOMFIELDLABEL_PRODUCTTRIAL,
        customField5: myProductTrial,
        customField6Label: CUSTOMFIELDLABEL_COMPANY,
        customField6: myCompany,
        customField7Label: CUSTOMFIELDLABEL_ADDRESS,
        customField7: myAddress,
        customField8Label: CUSTOMFIELDLABEL_POSTCODE,
        customField8: myPostcode,
        SF_SearchValue: mySearchValue,
    };

    CXBus.command('WebChatService.configure', {
        userData: myUserData,
    });

    _customPlugin.command('WebChat.open', config);
};

SageWebChatApi.prototype.getValidLanguage = function () {
    // Get valid language from locale.
    var result = LANGUAGE_EN;

    try {
        if (this.options.locale && this.options.locale.length > 0) {
            var temp = this.options.locale.toLowerCase();

            if (temp === LOCALE_FR_FR) {
                result = LANGUAGE_FR;
            } else if (temp === LOCALE_FR_CA) {
                result = LANGUAGE_FRCA;
            }
        }
    } catch (e) {}

    return result;
};

function getLanguageI18n() {
    var domain = getProductionDomain();
    var result = domain + '/i18n/localization.json';

    return result;
}

SageWebChatApi.prototype.getInteractionFlowDeploymentKey = function () {
    var result = '';

    try {
        if (this.options.deploymentKey && this.options.deploymentKey.length > 0) {
            // If a deployment key has been set, use it.
            result = this.options.deploymentKey;
        } else {
            // Get deployment key based on queue.

            var queueToMatch = this.options.queue.toLowerCase();

            for (var i = 0, len = _keysMatrix.length; i < len; i++) {
                var temp = _keysMatrix[i][KEYSMATRIXINDEX_QUEUENAME].toLowerCase();

                if (temp === queueToMatch) {
                    result = _keysMatrix[i][KEYSMATRIXINDEX_INTERACTIONFLOWDEPLOYTMENTKEY];
                    break;
                }
            }
        }
    } catch (e) {}

    if (result.length == 0) {
        // If no deployment key, use the default.
        result = DEPLOYMENTKEY_INTERACTIONFLOW_UKI;
    }

    return result;
};

SageWebChatApi.prototype.getStatusFlowDeploymentKey = function () {
    var result = '';

    try {
        if (this.options.statusFlowDeploymentKey && this.options.statusFlowDeploymentKey.length > 0) {
            // If a deployment key has been set, use it.
            result = this.options.statusFlowDeploymentKey;
        } else {
            // Get deployment key based on queue.

            var queueToMatch = this.options.queue.toLowerCase();

            for (var i = 0, len = _keysMatrix.length; i < len; i++) {
                var temp = _keysMatrix[i][KEYSMATRIXINDEX_QUEUENAME].toLowerCase();

                if (temp === queueToMatch) {
                    result = _keysMatrix[i][KEYSMATRIXINDEX_STATUSFLOWDEPLOYTMENTKEY];
                    break;
                }
            }
        }
    } catch (e) {}

    if (result.length == 0) {
        // If no deployment key, use the default.
        result = DEPLOYMENTKEY_STATUSFLOW_UKI;
    }

    return result;
};

SageWebChatApi.prototype.init = function () {
    CXBus.configure({ debug: false, pluginsPath: 'https://apps.mypurecloud.ie/widgets/9.0/plugins/' });
    CXBus.loadPlugin('widgets-core');

    var myOrgGuid = this.options.orgGuid ? this.options.orgGuid : ORGGUID_UKI;
    var myDeploymentKey = this.getInteractionFlowDeploymentKey();
    var myUrl = getCurrentUrl();
    var myI18n = getLanguageI18n();
    var myTranscriptTitle = TRANSCRIPT_TITLE;
    var myTranscriptMessage = TRANSCRIPT_MESSAGE;
    var myTranscriptPrimary = TRANSCRIPT_PRIMARY;
    var myTranscriptSecondary = TRANSCRIPT_SECONDARY;

    var myUserData = {
        customField1Label: CUSTOMFIELDLABEL_ACCOUNTNUMBER,
        customField1: DEFAULT_ACCOUNTNUMBER,
        customField2Label: CUSTOMFIELDLABEL_SUBJECT,
        customField2: DEFAULT_SUBJECT,
        customField3Label: CUSTOMFIELDLABEL_URL,
        customField3: myUrl,
        customField4Label: CUSTOMFIELDLABEL_PRODUCTPLAN,
        customField4: DEFAULT_PRODUCTPLAN,
        customField5Label: CUSTOMFIELDLABEL_PRODUCTTRIAL,
        customField5: DEFAULT_PRODUCTTRIAL,
        customField6Label: CUSTOMFIELDLABEL_COMPANY,
        customField6: DEFAULT_COMPANY,
        customField7Label: CUSTOMFIELDLABEL_ADDRESS,
        customField7: DEFAULT_ADDRESS,
        customField8Label: CUSTOMFIELDLABEL_POSTCODE,
        customField8: DEFAULT_POSTCODE,
    };

    window._genesys = {
        widgets: {
            main: {
                // set the theme, light in this case, and the custom stylesheet reference to any changes, see above
                theme: 'light',
                themes: {
                    light: 'cx-theme-light',
                    dark: 'cx-theme-dark',
                },
                lang: _language,
                i18n: myI18n,
                customStylesheetID: this.options.theme,
                downloadGoogleFont: false,
                mobileMode: 'auto',
                mobileModeBreakpoint: 550,
            },
            webchat: {
                transport: {
                    type: 'purecloud-v2-sockets',
                    dataURL: 'https://api.mypurecloud.ie',
                    deploymentKey: myDeploymentKey,
                    orgGuid: myOrgGuid,
                    interactionData: {
                        routing: {
                            targetType: 'QUEUE',
                            targetAddress: this.options.queue,
                            priority: 2,
                        },
                    },
                },
                userData: myUserData,
                emojis: true,
            },
        },
    };

    _customPlugin = CXBus.registerPlugin('custommatt');

    //_customPlugin.before('WebChat.open', function (oData) {
    //    try {
    //        // Enable form autosubmit ONLY for proactive chat
    //        if (oData.hasOwnProperty('proactive') && oData.proactive == true) {
    //            console.log(oData);
    //            oData.form = { autoSubmit: true };
    //            oData.formJSON = {};
    //        }
    //        return oData;
    //    } catch (e) {
    //        console.log(e);
    //        return oData;
    //    }
    //});

    _customPlugin.subscribe('WebChat.submitted', function (e) {
        logConsoleMessage('WebChat.submitted', e);

        var queue = getQueueFromWidget();

        if (queue.length > 0) {
            window._genesys.widgets.webchat.transport.interactionData.routing.targetAddress = queue;
        }
    });

    _customPlugin.subscribe('WebChatService.started', function (e) {
        logConsoleMessage('WebChatService.started', e);

        var validSession = isValidSession();

        if (!validSession) {
            // Empty the transcript if it is a different user.
            // Otherwise keep adding to the current transcript.
            _chatTranscript = '';
        }

        addToChatTranscript(TRANSCRIPT_WEBCHATSTARTED);

        if (_addWebFormDataToTranscript) {
            var msg = '';
            var attributesMsg = '';

            var myFirstName = getFormFirstName();

            if (myFirstName.length > 0) {
                msg = LABEL_FIRSTNAME + ': ' + myFirstName;
                addToChatTranscript(msg);
                attributesMsg += '<span>' + msg + '<br /></span>';
            }

            var myAccountNumber = getFormAccountNumber();
            if (myAccountNumber.length > 0) {
                msg = LABEL_ACCOUNTNUMBER + ': ' + myAccountNumber;
                addToChatTranscript(msg, false);
                attributesMsg += '<span>' + msg + '<br /></span>';
            }

            var mySubject = getFormSubject();
            if (mySubject.length > 0) {
                msg = LABEL_SUBJECT + ': ' + mySubject;
                addToChatTranscript(msg, false);
                attributesMsg += '<span>' + msg + '<br /></span>';
            }

            var myEmail = getFormEmail();
            if (myEmail.length > 0) {
                msg = LABEL_EMAIL + ': ' + myEmail;
                addToChatTranscript(msg, false);
                attributesMsg += '<span>' + msg + '<br /></span>';
            }

            var myCompany = getFormCompany();
            if (myCompany.length > 0) {
                msg = LABEL_COMPANY + ': ' + myCompany;
                addToChatTranscript(msg, false);
                attributesMsg += '<span>' + msg + '<br /></span>';
            }

            var myAddress = getFormAddress();
            if (myAddress.length > 0) {
                msg = LABEL_ADDRESS + ': ' + myAddress;
                addToChatTranscript(msg, false);
                attributesMsg += '<span>' + msg + '<br /></span>';
            }

            var myPostcode = getFormPostcode();
            if (myPostcode.length > 0) {
                msg = LABEL_POSTCODE + ': ' + myPostcode;
                addToChatTranscript(msg, false);
                attributesMsg += '<span>' + msg + '<br /></span>';
            }

            var myUrl = getCurrentUrl();
            if (myUrl.length > 0) {
                msg = LABEL_URL + ': ' + myUrl;
                addToChatTranscript(msg, false);
                attributesMsg += '<span>' + msg + '<br /></span>';
            }

            if (attributesMsg.length > 0) {
                injectMessage(attributesMsg);
            }
        }

        _chatConnected = true;

        window.connectedToPlatform = true;

        /* start interval timer to send messages to the client whilst
   the caller is in queue. As implemented here, these messages
   start whilst we are in the flow and perhaps talking to 
   a bot so the best place might be in MessageReceived - see below */
        _waitingMessageIntervalTimer = setInterval(function () {
            if (!_self.isChatOpen) {
                // Only inject the 'waiting' message if the queue is open.
                return;
            }

            _initialWaitingMessageCount--;

            var myMessage = _initialWaitingMessageCount < 0 ? MESSAGE_NEXTWAITING : MESSAGE_INITIALWAITING;

            logConsoleMessage(myMessage, e);

            injectMessage(myMessage);
        }, WAITING_MESSAGE_INTERVAL);
    });

    _customPlugin.subscribe('WebChatService.agentConnected', function (e) {
        logConsoleMessage('WebChatService.agentConnected', e);

        addToChatTranscript(TRANSCRIPT_AGENTCONNECTED);

        _agentConnected = true;

        // Agent has connected - clear timers.
        clearWaitingMessageIntervalTimer();
        clearTransferringMessageIntervalTimer();
    });

    _customPlugin.subscribe('WebChatService.ended', function (e) {
        logConsoleMessage('WebChatService.ended', e);

        addToChatTranscript(TRANSCRIPT_WEBCHATENDED);

        window.connectedToPlatform = false;
        _chatConnected = false;

        // Clear timers now that we know the chat has ended.
        clearWaitingMessageIntervalTimer();
        clearTransferringMessageIntervalTimer();

        // Prompt to download the transcript.
        _customPlugin.command('offerTranscript');
    });

    _customPlugin.subscribe('WebChatService.messageReceived', function (e) {
        logConsoleMessage('WebChatService.messageReceived', e);

        e.data.messages.forEach(function (arrayItem) {
            var now = Date(arrayItem.timestamp);
            var logMessage = now + ': ' + arrayItem.type;

            var from = arrayItem.from && arrayItem.from.name && arrayItem.from.name.length > 0 ? arrayItem.from.name : '';

            if (from.length > 0) {
                logMessage += ': ' + from;
            }

            var text = arrayItem.text && arrayItem.text.length > 0 ? arrayItem.text : '';

            if (text.length > 0) {
                logMessage += ': ' + text;
            }

            logConsoleMessage('[' + logMessage + ']\n');

            if (arrayItem.from) {
                if (arrayItem.type == 'Message' && (arrayItem.from.type == 'Agent' || arrayItem.from.type == 'Client' || arrayItem.from.type == 'External')) {
                    // We have received a message from the agent or from the customer
                    var msg = '';

                    if (from.length > 0) {
                        msg += from + ': ';
                    }

                    if (text.length > 0) {
                        msg += text;
                    }

                    addToChatTranscript(msg);
                }
            }
        });
    });

    _customPlugin.before('WebChat.open', function (e) {
        logConsoleMessage('Webchat before open');

        try {
            // Enable form autosubmit ONLY for proactive chat
            if (e.hasOwnProperty('proactive') && e.proactive == true) {
                e.form = {
                    autoSubmit: true,
                };
                e.formJSON = {};
                console.log(e);
                return e;
            }
        } catch (error) {
            console.log(error);

            return error;
        }

        var restoringMsg = 'undefined';
        var restoring = false;

        if (typeof e.restoring !== 'undefined') {
            restoring = e.restoring;
            restoringMsg = e.restoring;
        }

        if (restoring) {
            var validSession = isValidSession();

            if (!validSession) {
                // This is web chat between sessions with different accounts.
                // End the existing chat and do not restore the chat window.
                setCookie(COOKIE_TRANSCRIPTOFFEROPEN, FLAG_TRUE);
                endWebChat();

                return null;
            }
        } else {
            // Only do this if NOT restoring otherwise a new widget appears.

            if (!_autoSubmit) {
                // To ensure that the subject is selected in the web form.
                e.form = {
                    subject: _selectedSubject,
                };
            }
        }

        logConsoleMessage('Webchat before open: restoring = ' + restoringMsg);

        return e;
    });

    // Register our own events on the CX Bus for our custom plugin
    _customPlugin.registerEvents(['ready', 'transcriptOfferOpened', 'transcriptOfferClosed']);

    // Register a command to close the transcript offer
    _customPlugin.registerCommand('closeOfferTranscript', function (e1) {
        var transcriptOfferOpen = getCookie(COOKIE_TRANSCRIPTOFFEROPEN);

        if (transcriptOfferOpen === FLAG_TRUE) {
            _customPlugin
                .command('Toaster.close')
                .done(function (e2) {
                    logConsoleMessage('Closing Transcript Toaster');

                    setCookie(COOKIE_TRANSCRIPTOFFEROPEN, FLAG_FALSE);

                    _customPlugin.publish('transcriptOfferClosed');
                    e1.deferred.resolve();
                })
                .fail(function () {
                    e1.deferred.reject('Transcript Toaster could not close');
                });
        } else {
            e1.deferred.reject('Transcript Toaster is already closed');
        }
    });

    _customPlugin.registerCommand('offerTranscript', function (e1) {
        logConsoleMessage('OfferTranscript command triggered');

        var transcriptOfferOpen = getCookie(COOKIE_TRANSCRIPTOFFEROPEN);

        // Open a toaster with two buttons
        if (transcriptOfferOpen === FLAG_TRUE) {
            e1.deferred.reject('Transcript Toaster is already open');
            return;
        }

        endWebChat();
        closeWebChat();

        _customPlugin
            .command('Toaster.open', {
                type: 'generic',
                title: myTranscriptTitle,
                icon: 'star',
                controls: 'close',
                buttons: {
                    type: 'binary',
                    primary: myTranscriptPrimary,
                    secondary: myTranscriptSecondary,
                },
            })
            .done(function (e2) {
                // Handle success
                logConsoleMessage('Transcript Toaster was opened');

                setCookie(COOKIE_TRANSCRIPTOFFEROPEN, FLAG_TRUE);

                e2.html.find('.cx-body').append('<div class="cx-message-text">' + myTranscriptMessage + '</div>');

                // Setup buttons
                e2.html.find('.cx-btn.cx-btn-primary').click(function () {
                    logConsoleMessage('Primary button pressed');

                    if (_pdfEnabled) {
                        formatTranscriptAsPdf(_chatTranscript);
                    } else {
                        var filename = 'SageChatTranscript-' + getFormattedDate() + '.txt';
                        var hiddenTranscriptLink = document.createElement('a');

                        hiddenTranscriptLink.href = 'data:attachment/text,' + encodeURI(_chatTranscript);
                        hiddenTranscriptLink.target = '_blank';
                        hiddenTranscriptLink.download = filename;
                        hiddenTranscriptLink.click();
                    }

                    _customPlugin.command('closeOfferTranscript');
                });

                e2.html.find('.cx-btn.cx-btn-default').click(function () {
                    logConsoleMessage('Default button pressed');
                    _customPlugin.command('closeOfferTranscript');
                });

                /* If the overlay is closed by hand (X Button),
      or is closed automatically when another widget opens in overlay mode,
      this unique event will be published, informing you that your widget
      overlay was closed */
                if (e2.events.close) {
                    _customPlugin.subscribe(e2.events.close, function () {
                        logConsoleMessage('Transcript Toaster was closed');
                        _customPlugin.unsubscribe(e2.events.close);
                    });
                }

                _customPlugin.publish('transcriptOfferOpened');
                e1.deferred.resolve();
            })
            .fail(function (e) {
                // Handle failure
                e1.deferred.reject('Transcript Toaster could not open');
            });
    });

    _customPlugin.subscribe('WebChatService.agentDisconnected', function (e) {
        logConsoleMessage('WebChatService.agentDisconnected', e);

        _agentConnected = false;

        if (_chatConnected == true) {
            setTimeout(function () {
                // Delay before injecting transferring message - to handle a chat being ended or transferred.
                addToChatTranscript(TRANSCRIPT_AGENTDISCONNECTED);
                injectTransferringMessage();
            }, TRANSFERRING_MESSAGE_DELAY);

            setTimeout(function () {
                // Delay before injecting transferring message - to handle a chat being ended or transferred.
                _transferringMessageIntervalTimer = setInterval(injectTransferringMessage, TRANSFERRING_MESSAGE_INTERVAL);
            }, TRANSFERRING_MESSAGE_DELAY2);
        }
    });
};

function injectMessage(myMessage) {
    _customPlugin
        .command('WebChat.injectMessage', {
            type: 'html',
            text: myMessage,
            custom: false,
            bubble: {
                time: true,
            },
        })
        .done(function (e1) {
            // WebChat sent a message successfully
            logConsoleMessage('WebChat.injectMessage success', e1);
        })
        .fail(function (e2) {
            // WebChat failed to send a message
            logConsoleMessage('WebChat.injectMessage failed', e2);
        });
}

function isIE11OrBelow() {
    var result = false;

    try {
        var myUserAgent = window.navigator.userAgent;
        var myIndex = myUserAgent.indexOf('MSIE');
        var myVersionNumber = 0;

        if (myIndex > 0) {
            // IE, check version number.
            myVersionNumber = parseInt(myUserAgent.substring(myIndex + 5, myUserAgent.indexOf('.', myIndex)));

            result = myVersionNumber !== 0;
        } else if (!!navigator.userAgent.match(/Trident\/7\./)) {
            // IE 11.
            result = true;
        }
    } catch (e) {}

    return result;
}

function endWebChat() {
    if (_customPlugin) {
        _customPlugin
            .command('WebChatService.endChat')
            .done(function (e) {
                logConsoleMessage('WebChatService.endChat success', e);
            })
            .fail(function (e2) {
                logConsoleMessage('WebChatService.endChat fail', e2);
            });
    }
}

function closeWebChat() {
    if (_customPlugin) {
        _customPlugin
            .command('WebChat.close')
            .done(function (e) {
                logConsoleMessage('WebChat.close success', e);
            })
            .fail(function (e2) {
                logConsoleMessage('WebChat.close fail', e2);
            });
    }
}

function getCookieDomain() {
    var result = '';

    try {
        var hostname = location.host;
        var hostSplit = hostname.split('.');
        var hostSplitLength = hostSplit.length;

        if (hostSplitLength > 1) {
            result = hostSplit[hostSplitLength - 2] + '.' + hostSplit[hostSplitLength - 1];
        }
    } catch (e) {}

    return result;
}

function setCookie(cname, cvalue) {
    var domain = getCookieDomain();
    var cookie = cname + '=' + cvalue + ';path=/';

    if (domain.length > 0) {
        cookie += ';domain=.' + domain;
    }

    document.cookie = cookie;
}

function getCookie(cname) {
    var name = cname + '=';
    var decodedCookie = decodeURIComponent(document.cookie);
    var ca = decodedCookie.split(';');

    for (var i = 0; i < ca.length; i++) {
        var c = ca[i];
        while (c.charAt(0) == ' ') {
            c = c.substring(1);
        }
        if (c.indexOf(name) == 0) {
            return c.substring(name.length, c.length);
        }
    }

    return '';
}

function isValidSession() {
    // Check if sessions between different users before starting a new chat.
    var result = true;

    var accountNumber = getCookie(COOKIE_ACCOUNTNUMBER);
    var lastAccountNumber = getCookie(COOKIE_LASTACCOUNTNUMBER);

    if (accountNumber.length > 0 && lastAccountNumber.length > 0) {
        result = accountNumber === lastAccountNumber;
    }

    return result;
}

function launchWebChatIsUnavailbleToaster() {
    // This is web chat between sessions with different accounts.
    // Do not start a new chat.

    if (_customPlugin) {
        _customPlugin
            .command('Toaster.open', {
                type: 'generic',
                title: 'Restart Live Chat',
                icon: '',
                controls: '',
                body: 'Close and reopen your browser to fix Live Chat.',
                buttons: {
                    type: 'binary',
                    primary: 'Close',
                    secondary: 'Cancel',
                },
            })
            .done(function (e2) {
                // Handle success
                logConsoleMessage('Web chat unavailable Toaster was opened');

                // Setup buttons
                e2.html.find('.cx-btn.cx-btn-primary').click(function () {
                    _customPlugin.command('Toaster.close');
                });

                var secondaryButton = e2.html.find('.cx-btn.cx-btn-default');

                if (secondaryButton.length > 0) {
                    // We don't need two buttons so hide the secondary one.
                    secondaryButton[0].classList.add('cx-hidden');
                }
            })
            .fail(function (e) {
                // Handle failure
                e.deferred.reject('Web chat unavailable Toaster could not open');
            });
    }
}

SageWebChatApi.prototype.verifyWebChatStatus = function () {
    var _this2 = this;

    _requireScriptInterval2 = setInterval(function () {
        // Set interval while requirejs script loads, i.e. require.js.
        if (window.hasOwnProperty('requirejs')) {
            _requireJs = true;

            requirejs([GUEST_API_URL], function (platformClient) {
                _platformClient = platformClient;
                _this2.platformClient = _platformClient;
                _client = platformClient.ApiClient.instance;

                // Set environment to mypurecloud.ie.
                _client.setEnvironment(platformClient.PureCloudRegionHosts.eu_west_1);

                _this2.verifyWebChatStatusFromFlow();

                if (_requireScriptInterval2) {
                    clearInterval(_requireScriptInterval2);
                }

                return;
            });
        } else if (window.hasOwnProperty('require')) {
            _platformClient = require('platformClient');
            _this2.platformClient = _platformClient;
            _client = _platformClient.ApiClient.instance;

            // Set environment to mypurecloud.ie.
            _client.setEnvironment(_platformClient.PureCloudRegionHosts.eu_west_1);

            _this2.verifyWebChatStatusFromFlow();

            if (_requireScriptInterval2) {
                clearInterval(_requireScriptInterval2);
            }

            return;
        }
    }, REQUIRE_SCRIPT_INTERVAL);
};
